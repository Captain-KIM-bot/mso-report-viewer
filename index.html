<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>MSO ë¦¬í¬íŠ¸</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>MSO ë¦¬í¬íŠ¸ ë·°ì–´</h1>
  <div class="selector">
    <select id="hospital" onchange="onHospitalChange()"><option>ë³‘ì› ì„ íƒ</option></select>
    <select id="branch" onchange="onBranchChange()"><option>ì§€ì  ì„ íƒ</option></select>
  </div>

  <h2>ğŸ“„ ë³´ê³ ì„œ</h2>
  <div id="report-buttons" class="buttons"></div>

  <h2>ğŸ“ ì¶”ê°€ìë£Œ</h2>
  <select id="extra-report" onchange="onExtraChange()">
    <option>ì¶”ê°€ìë£Œ ì„ íƒ</option>
  </select>

  <iframe id="viewer" style="display:none;"></iframe>
  <script src="data.js"></script>
  <script>
    const hSelect = document.getElementById("hospital"),
          bSelect = document.getElementById("branch"),
          btnArea = document.getElementById("report-buttons"),
          extra = document.getElementById("extra-report"),
          frame = document.getElementById("viewer");

    function populateHospitals() {
      Object.keys(data).forEach(h => {
        const o = new Option(data[h].name, h);
        hSelect.add(o);
      });
    }

    function onHospitalChange() {
      bSelect.innerHTML = "<option>ì§€ì  ì„ íƒ</option>";
      btnArea.innerHTML = "";
      extra.innerHTML = "<option>ì¶”ê°€ìë£Œ ì„ íƒ</option>";
      frame.style.display = "none";
      const branchData = data[hSelect.value]?.branches || {};
      Object.keys(branchData).forEach(b => {
        bSelect.add(new Option(branchData[b].name, b));
      });
    }

    function onBranchChange() {
      btnArea.innerHTML = "";
      extra.innerHTML = "<option>ì¶”ê°€ìë£Œ ì„ íƒ</option>";
      frame.style.display = "none";
      const urlData = data[hSelect.value].branches[bSelect.value].reports || {};
      Object.entries(urlData).forEach(([mo, url]) => {
        const b = document.createElement("button");
        b.textContent = mo;
        b.onclick = () => load(url);
        btnArea.append(b);
        // ì¶”ê°€ìë£ŒëŠ” ë™ì¼ URL ì‚¬ìš© ê°€ëŠ¥
        const opt = new Option(mo, url);
        extra.add(opt);
      });
    }

    function onExtraChange() {
      load(extra.value);
    }

    function load(url) {
      frame.src = url + "?widget=true&headers=false";
      frame.style.display = "block";
    }

    window.onload = populateHospitals;
  </script>
</body>
</html>
